"use strict";(self.webpackChunkharvester_docs=self.webpackChunkharvester_docs||[]).push([[409],{14807:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>c,frontMatter:()=>r,metadata:()=>i,toc:()=>l});a(67294);var n=a(3905);const r={sidebar_position:6,sidebar_label:"Volume Security",title:"Volume Security",keywords:["Volume Security","Image Security"]},s=void 0,i={unversionedId:"volume/volume-security",id:"volume/volume-security",title:"Volume Security",description:"Available as of v1.4.0",source:"@site/docs/volume/volume-security.md",sourceDirName:"volume",slug:"/volume/volume-security",permalink:"/v1.5/volume/volume-security",draft:!1,editUrl:"https://github.com/harvester/docs/edit/main/docs/volume/volume-security.md",tags:[],version:"current",lastUpdatedAt:1733305603,formattedLastUpdatedAt:"Dec 4, 2024",sidebarPosition:6,frontMatter:{sidebar_position:6,sidebar_label:"Volume Security",title:"Volume Security",keywords:["Volume Security","Image Security"]},sidebar:"api",previous:{title:"Volume Snapshots",permalink:"/v1.5/volume/volume-snapshots"},next:{title:"Upload Images",permalink:"/v1.5/image/upload-image"}},o={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Encrypted Volumes",id:"encrypted-volumes",level:2},{value:"Advanced Usage with Rancher Integration",id:"advanced-usage-with-rancher-integration",level:2},{value:"Limitations",id:"limitations",level:2}],m={toc:l},p="wrapper";function c({components:e,...t}){return(0,n.kt)(p,{...m,...t,components:e,mdxType:"MDXLayout"},(0,n.kt)("head",null,(0,n.kt)("link",{rel:"canonical",href:"https://docs.harvesterhci.io/v1.4/volume/volume-security"})),(0,n.kt)("p",null,(0,n.kt)("em",{parentName:"p"},"Available as of v1.4.0")),(0,n.kt)("p",null,"Harvester v1.4.0 and later versions allow you to encrypt and decrypt virtual machine images. The encryption mechanism utilizes the Linux kernel module dm_crypt and the command-line utility cryptsetup."),(0,n.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,n.kt)("p",null,"Prepare the following resources:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Secret: A Kubernetes secret is used as the passphrase of dm_crypt. You must specify the value of the ",(0,n.kt)("inlineCode",{parentName:"p"},"CRYPTO_KEY_VALUE")," field. All other fields are fixed."),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("img",{src:a(16434).Z,width:"2219",height:"1285"})),(0,n.kt)("p",{parentName:"li"},"Example Secret:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: Secret\nmetadata:\n  name: encryption\n  namespace: default\ndata:\n  CRYPTO_KEY_CIPHER: aes-xts-plain64\n  CRYPTO_KEY_HASH: sha256\n  CRYPTO_KEY_PROVIDER: secret\n  CRYPTO_KEY_SIZE: 256\n  CRYPTO_KEY_VALUE: "Your encryption passphrase"\n  CRYPTO_PBKDF: argon2i\n')),(0,n.kt)("admonition",{parentName:"li",title:"important",type:"info"},(0,n.kt)("p",{parentName:"admonition"},"You can create a secret in the system namespace using kubectl or the Harvester UI (",(0,n.kt)("strong",{parentName:"p"},"Edit as YAML")," feature). Resources in the system namespace are not displayed on the Harvester UI ",(0,n.kt)("strong",{parentName:"p"},"Secrets")," screen."))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"StorageClass: Images are encrypted using Longhorn, so required fields must be passed to the Longhorn CSI Driver. You can specify the encryption secret when creating a StorageClass. For more information, see ",(0,n.kt)("a",{parentName:"p",href:"./upload-image#image-storageclass"},"Image StorageClass"),". "),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("img",{src:a(11394).Z,width:"2126",height:"1280"})),(0,n.kt)("p",{parentName:"li"},"Example of a StorageClass:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},'allowVolumeExpansion: true\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: encryption\nparameters:\n  csi.storage.k8s.io/node-publish-secret-name: encryption\n  csi.storage.k8s.io/node-publish-secret-namespace: default\n  csi.storage.k8s.io/node-stage-secret-name: encryption\n  csi.storage.k8s.io/node-stage-secret-namespace: default\n  csi.storage.k8s.io/provisioner-secret-name: encryption\n  csi.storage.k8s.io/provisioner-secret-namespace: default\n  encrypted: "true"\n  migratable: "true"\n  numberOfReplicas: "3"\n  staleReplicaTimeout: "2880"\nprovisioner: driver.longhorn.io\nreclaimPolicy: Delete\nvolumeBindingMode: Immediate\n')),(0,n.kt)("admonition",{parentName:"li",title:"important",type:"info"},(0,n.kt)("p",{parentName:"admonition"},"You can create a secret in the system namespace using the Harvester UI (",(0,n.kt)("strong",{parentName:"p"},"Edit as YAML")," feature) and kubectl. Resources in the system namespace are not displayed on the Harvester UI ",(0,n.kt)("strong",{parentName:"p"},"Secrets")," screen.")))),(0,n.kt)("h2",{id:"encrypted-volumes"},"Encrypted Volumes"),(0,n.kt)("p",null,"You can create an encrypted volume using an encrypted StorageClass on the following UI locations:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Volumes: Create")," screen"),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("img",{alt:"create-empty-volume",src:a(24606).Z,width:"1560",height:"876"}))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Volumes")," tab on the ",(0,n.kt)("strong",{parentName:"p"},"Virtual Machine: Create")," screen"),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("img",{alt:"create-empty-volume",src:a(43156).Z,width:"2131",height:"1286"})))),(0,n.kt)("h2",{id:"advanced-usage-with-rancher-integration"},"Advanced Usage with Rancher Integration"),(0,n.kt)("p",null,"The secret is an unencrypted Base64-encoded string. To keep the secret safe, you can use projects and namespaces to isolate permissions. For more information, see ",(0,n.kt)("a",{parentName:"p",href:"../rancher/virtualization-management#multi-tenancy"},"Multi-Tenancy"),"."),(0,n.kt)("h2",{id:"limitations"},"Limitations"),(0,n.kt)("p",null,"You cannot perform the following actions:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Export a new volume from an encrypted volume"),(0,n.kt)("li",{parentName:"ul"},"Restore an encrypted volume to an unencrypted volume"),(0,n.kt)("li",{parentName:"ul"},"Restore an unencrypted volume to an encrypted volume")))}c.isMDXComponent=!0},16434:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/create-encryption-used-secret-b44633a2b959564b479b342138f46bbc.png"},11394:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/create-storage-class-dee441e12088cf661423b606809464f3.png"},43156:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/create-empty-volume-in-vm-fed89e4c587e1c27d25ed07e8b0c800f.png"},24606:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/create-empty-volume-cd41e67d0063bc3bf81593d305e95634.png"}}]);