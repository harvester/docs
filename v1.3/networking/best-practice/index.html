<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-v1.3 plugin-docs plugin-id-default docs-doc-id-networking/best-practice" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Harvester Network Best Practice | Harvester</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.harvesterhci.io/v1.3/networking/best-practice"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="v1.3"><meta data-rh="true" name="docusaurus_tag" content="docs-default-v1.3"><meta data-rh="true" name="docsearch:version" content="v1.3"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-v1.3"><meta data-rh="true" property="og:title" content="Harvester Network Best Practice | Harvester"><meta data-rh="true" name="description" content="Replace Ethernet NICs"><meta data-rh="true" property="og:description" content="Replace Ethernet NICs"><meta data-rh="true" name="keywords" content="Harvester,Networking,Best Practice"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="alternate" href="https://docs.harvesterhci.io/v1.3/networking/best-practice" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.harvesterhci.io/v1.3/networking/best-practice" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://U7QCSJFCWR-dsn.algolia.net" crossorigin="anonymous"><link data-rh="true" rel="canonical" href="https://docs.harvesterhci.io/v1.1/networking/best-practice"><link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-57KS2MW",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>


<link rel="search" type="application/opensearchdescription+xml" title="Harvester" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.5e59b31b.css">
<link rel="preload" href="/assets/js/runtime~main.45156ca4.js" as="script">
<link rel="preload" href="/assets/js/main.2f7351ae.js" as="script">
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-57KS2MW" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo_horizontal.svg" alt="Harvester Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo_horizontal.svg" alt="Harvester Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/v1.3/">v1.3</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/v1.5/networking/best-practice">v1.5 (dev)</a></li><li><a class="dropdown__link" href="/v1.4/networking/best-practice">v1.4 (latest)</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/v1.3/networking/best-practice">v1.3</a></li><li><a class="dropdown__link" href="/v1.2/networking/best-practice">v1.2 (EOL)</a></li><li><a class="dropdown__link" href="/v1.1/">v1.1 (EOL)</a></li><li><a class="dropdown__link" href="/v1.0/">v1.0 (EOL)</a></li><li><a class="dropdown__link" href="/v0.3/">v0.3 (EOL)</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/v1.3/networking/best-practice" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Quick Links</a><ul class="dropdown__menu"><li><a href="https://harvesterhci.io/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Harvester Home<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/harvester/harvester" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/harvester/docs" target="_blank" rel="noopener noreferrer" class="dropdown__link">Docs GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://harvesterhci.io/kb" target="_blank" rel="noopener noreferrer" class="dropdown__link">Knowledge Base<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.suse.com/c/?s=harvester" target="_blank" rel="noopener noreferrer" class="dropdown__link">Blog<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">More from SUSE</a><ul class="dropdown__menu"><li><a href="https://www.rancher.com" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__rancher">Rancher<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="https://elemental.docs.rancher.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__elemental">Elemental<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://fleet.rancher.io/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__fleet">Fleet<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://rancherdesktop.io/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__rancherdesktop">Rancher Desktop<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="https://opensource.suse.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__suse">More Projects...<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/v1.3/">Harvester Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/v1.3/getting-started/deploy-ha-cluster">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/v1.3/install/requirements">Installation</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/v1.3/airgap">Air Gapped Environment</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/v1.3/upgrade/index">Upgrade</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/v1.3/authentication">Authentication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/v1.3/upload-image">Upload Images</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/v1.3/host/">Host Management</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/v1.3/vm/index">VM Management</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/v1.3/volume/index">Volume Management</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/v1.3/networking/index">Networking</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v1.3/networking/index">Cluster Network</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v1.3/networking/harvester-network">VM Network</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v1.3/networking/deep-dive">Harvester Network Deep Dive</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v1.3/networking/loadbalancer">Load Balancer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v1.3/networking/ippool">IP Pool</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/v1.3/networking/best-practice">Harvester Network Best Practice</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/v1.3/logging/harvester-logging">Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/v1.3/monitoring/harvester-monitoring">Monitoring</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/v1.3/advanced/index">Advanced</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/v1.3/rancher/rancher-integration">Rancher Integration</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/v1.3/terraform/terraform-provider">Harvester Terraform Provider</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/v1.3/troubleshooting/index">Troubleshooting</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/v1.3/faq">FAQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/v1.3/developer/developer-mode-installation">Developer</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/v1.3/api/harvester-apis">api</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_xLCN"><div class="docItemContainer_jfFK"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Networking</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Harvester Network Best Practice</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v1.3</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Harvester Network Best Practice</h1></header><div class="row"><div class="col col--12"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="replace-ethernet-nics">Replace Ethernet NICs<a href="#replace-ethernet-nics" class="hash-link" aria-label="Direct link to Replace Ethernet NICs" title="Direct link to Replace Ethernet NICs">​</a></h2><p>You may want to replace the Ethernet NICs of a bare-metal node in a Harvester cluster for various reasons, including the following:</p><ul><li><p>Malfunction or damage</p></li><li><p>Insufficent hardware capacity</p></li><li><p>Missing features</p></li></ul><p>You can follow the steps below and run them in each node step by step.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pre-replacement-checks">Pre-Replacement Checks<a href="#pre-replacement-checks" class="hash-link" aria-label="Direct link to Pre-Replacement Checks" title="Direct link to Pre-Replacement Checks">​</a></h3><ol><li><p>Verify that the installed Harvester version supports the new NICs.</p></li><li><p>Test the new NICs in non-production environment.</p></li><li><p>On the <a href="/v1.3/vm/access-to-the-vm#access-with-the-harvester-ui"><strong>Virtual Machines</strong> screen of the Harvester UI</a>, verify that the status of all VMs is either <em>Running</em> or <em>Stopped</em>.</p></li><li><p>On the <a href="/v1.3/troubleshooting/harvester#access-embedded-rancher-and-longhorn-dashboards">embedded Longhorn dashboard</a>, verify that the status of all Longhorn volumes is <em>Healthy</em>.</p></li><li><p>(Optional) On the <strong>Harvester Support</strong> screen, generate a <a href="/v1.3/troubleshooting/harvester#generate-a-support-bundle">support bundle</a> for comparison purposes.</p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="collect-information">Collect Information<a href="#collect-information" class="hash-link" aria-label="Direct link to Collect Information" title="Direct link to Collect Information">​</a></h3><p>Before any action is taken, it is important to collect the current network information and status.</p><ul><li><p>Harvester network configuration: By default, Harvester creates a bond interface named <code>mgmt-bo</code> for the management network and one new bond interface for each cluster network. Harvester saves network configuration details in the file <code>/oem/90_custom.yaml</code>.</p><p>  Example: A NIC named <code>ens3</code> was added to the <code>mgmt-bo</code> bond interface.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- path: /etc/sysconfig/network/ifcfg-mgmt-bo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  permissions: 384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  owner: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  group: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  content: |+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    STARTMODE=&#x27;onboot&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BONDING_MASTER=&#x27;yes&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BOOTPROTO=&#x27;none&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    POST_UP_SCRIPT=&quot;wicked:setup_bond.sh&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BONDING_SLAVE_0=&#x27;ens3&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BONDING_MODULE_OPTS=&#x27;miimon=100 mode=active-backup &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DHCLIENT_SET_DEFAULT_ROUTE=&#x27;no&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  encoding: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ownerstring: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- path: /etc/sysconfig/network/ifcfg-ens3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  permissions: 384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  owner: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  group: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  content: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    STARTMODE=&#x27;hotplug&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BOOTPROTO=&#x27;none&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  encoding: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ownerstring: &quot;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Physical NICs: You can use the command <code>ip link</code> to retrieve related information, including the state of each NIC and the corresponding master (if applicable).</p><p>  Example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ip link | grep master -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2: ens3: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast master mgmt-bo state UP mode DEFAULT group default qlen 1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    link/ether 52:54:00:03:3a:e4 brd ff:ff:ff:ff:ff:ff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4: mgmt-bo: &lt;BROADCAST,MULTICAST,MASTER,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master mgmt-br state UP mode DEFAULT group default qlen 1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    link/ether 52:54:00:03:3a:e4 brd ff:ff:ff:ff:ff:ff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>PCI devices: You can use the command <code>lspci</code> to retrieve a list of devices, which allows you to quickly identify the network NICs. To retrieve detailed information about each device, use the command <code>lspci -v</code>.</p><p>  Example (<code>lspci</code>):</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ lspci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00:03.0 Ethernet controller: Intel Corporation 82540EM Gigabit Ethernet Controller (rev 03)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>  Example (<code>lspci -v</code>):</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ lspci -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00:03.0 Ethernet controller: Intel Corporation 82540EM Gigabit Ethernet Controller (rev 03)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Subsystem: Red Hat, Inc. QEMU Virtual Machine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Physical Slot: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Flags: bus master, fast devsel, latency 0, IRQ 11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Memory at fc080000 (32-bit, non-prefetchable) [size=128K]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I/O ports at c000 [size=64]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Expansion ROM at fc000000 [disabled] [size=512K]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Kernel driver in use: e1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Kernel modules: e1000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Linux kernel log: You can use the command <code>dmesg</code> to display kernel messages, which include most of the required information. If you save the messages to <code>kernel.log</code>, you can check the driver and link status.</p><p>  Harvester places sub-NICs into the bond interfaces. In the following example, an additional bond interface named <code>data-bo</code> is created in the cluster.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ grep &quot;(slave&quot; kernel.log  (or: dmesg | grep &quot;(slave&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:35:00 localhost kernel: mgmt-bo: (slave eno5): Enslaving as a backup interface with an up link</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:35:00 localhost kernel: mgmt-bo: (slave ens4f0): Enslaving as a backup interface with an up link</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:37:34 localhost kernel: data-bo: (slave eno6): Enslaving as a backup interface with an up link</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:37:35 localhost kernel: data-bo: (slave ens4f1): Enslaving as a backup interface with an up link</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>  The NICs are renamed.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ grep &quot;renamed&quot; kernel.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:34:48 localhost kernel: tg3 0000:02:00.0 eno1: renamed from eth2 // eth2 / eno1 is not used by Harvester</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:34:48 localhost kernel: tg3 0000:02:00.3 eno4: renamed from eth6 // eth6 / eno4 is not used by Harvester</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:34:48 localhost kernel: tg3 0000:02:00.2 eno3: renamed from eth5 // eth5 / eno3 is not used by Harvester</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:34:48 localhost kernel: tg3 0000:02:00.1 eno2: renamed from eth3 // eth3 / eno2 is not used by Harvester</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:34:49 localhost kernel: i40e 0000:5d:00.0 eno5: renamed from eth0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:34:49 localhost kernel: i40e 0000:af:00.0 ens4f0: renamed from eth4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:34:49 localhost kernel: i40e 0000:5d:00.1 eno6: renamed from eth1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:34:49 localhost kernel: i40e 0000:af:00.1 ens4f1: renamed from eth2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>  The NIC driver of <code>eno5(0000:5d:00.0)</code> is <code>(intel) i40e 10Gbps Full Duplex</code>.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ grep &quot;0000:5d:00.0&quot; kernel.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:34:47 localhost kernel: i40e 0000:5d:00.0: fw 8.71.63306 api 1.11 nvm 10.54.7 [8086:1572] [103c:22fc]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:34:47 localhost kernel: i40e 0000:5d:00.0: MAC address: 48:df:37:24:c2:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:34:47 localhost kernel: i40e 0000:5d:00.0: FW LLDP is enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:34:47 localhost kernel: i40e 0000:5d:00.0 eth0: NIC Link is Up, 10 Gbps Full Duplex, Flow Control: None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:34:47 localhost kernel: i40e 0000:5d:00.0: PCI-Express: Speed 8.0GT/s Width x8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:34:47 localhost kernel: i40e 0000:5d:00.0: Features: PF-id[0] VFs: 64 VSIs: 66 QP: 112 RSS FD_ATR FD_SB NTUPLE DCB VxLAN Geneve PTP VEPA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:34:49 localhost kernel: i40e 0000:5d:00.0 eno5: renamed from eth0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>  The enabled NICs are detected.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ grep &quot;is Up&quot; kernel.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:34:47 localhost kernel: i40e 0000:5d:00.0 eth0: NIC Link is Up, 10 Gbps Full Duplex, Flow Control: None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:34:48 localhost kernel: i40e 0000:5d:00.1 eth1: NIC Link is Up, 10 Gbps Full Duplex, Flow Control: None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:34:48 localhost kernel: i40e 0000:af:00.0 eth4: NIC Link is Up, 10 Gbps Full Duplex, Flow Control: None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 08 00:34:49 localhost kernel: i40e 0000:af:00.1 eth2: NIC Link is Up, 10 Gbps Full Duplex, Flow Control: None</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="enable-maintenance-mode">Enable Maintenance Mode<a href="#enable-maintenance-mode" class="hash-link" aria-label="Direct link to Enable Maintenance Mode" title="Direct link to Enable Maintenance Mode">​</a></h3><ol><li><p>(Optional) Stop VMs that cannot or must not be migrated.</p></li><li><p><a href="/v1.3/host/#node-maintenance">Enable maintenance mode</a> on the target node to automatically migrate all VMs to other nodes.</p></li></ol><ul><li><p>Wait for everything to become ready, and then repeat the steps in the <a href="#pre-check">Pre-check</a> section.</p></li><li><p>Manually stop a VM in the following situations:</p><ul><li><p>The VM fails to migrate.</p></li><li><p>The VM has selectors that prevent it from migrating to other nodes.</p></li><li><p>The VM has special hardware (for example, PCI passthrough or vGPUs) that prevent it from migrating to other nodes.</p></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="optional-update-the-network-config">(Optional) Update the Network Config<a href="#optional-update-the-network-config" class="hash-link" aria-label="Direct link to (Optional) Update the Network Config" title="Direct link to (Optional) Update the Network Config">​</a></h3><p>There are one or more <a href="/v1.3/networking/index#how-to-create-a-new-cluster-network">Network Config</a> under every <a href="/v1.3/networking/index#cluster-network">Cluster Network</a> on Harvester. Each <code>Network Config</code> is backed by a <code>VlanConfig</code> CRD object.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_S0QG"><p>Updating the <code>Network Config</code> is <strong>required</strong> if the new NICs will be placed in different physical slots or will have different uplink parameters.</p></div></div><ol><li><p>Check the node.</p><p>When a Harvester cluster node belongs to a <code>Network Config</code>, the <code>Node</code> object has a label with the key <code>network.harvesterhci.io/vlanconfig</code>.</p><p>Example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    network.harvesterhci.io/vlanconfig: vlan123</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Remove this node from the <code>Network Config</code>.</p><p>When the new NICs are placed in different slots, you must change the <code>Network Config</code> to exclude this node. You can delete the VlanConfig if the <code>Network Config</code> object selects only this node from <code>nodeSelector</code>.</p><p>Example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: network.harvesterhci.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: VlanConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  clusterNetwork: data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nodeSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kubernetes.io/hostname: node123  // select one or more nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uplink:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bondOptions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      miimon: 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      mode: 802.3ad</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    linkAttributes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      mtu: 1500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      txQLen: -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - enp0s1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - enp0s2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When VMs are still running on an affected node, the network webhook returns an error.</p></li><li><p>Check the <code>Node</code> object.</p><p>Depending on the situation, either the label <code>network.harvesterhci.io/vlanconfig</code> changes or is removed.</p></li><li><p>Check the <code>VlanStatus</code> object.</p><p>Depending on the situation, either the status of the <code>VlanStatus</code> object&#x27;s <code>ready</code> condition changes to <code>&quot;True&quot;</code> or the object is deleted.</p><p>Example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: network.harvesterhci.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: VlanStatus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">status:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  clusterNetwork: data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  conditions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - lastUpdateTime: &quot;2024-02-03T18:32:41Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status: &quot;True&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type: ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  linkMonitor: public</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  localAreas:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - cidr: 10.190.186.0/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vlanID: 2013</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  node: node123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vlanConfig: vlan123</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="optional-drain-the-node">(Optional) Drain the Node<a href="#optional-drain-the-node" class="hash-link" aria-label="Direct link to (Optional) Drain the Node" title="Direct link to (Optional) Drain the Node">​</a></h3><p>You may find that some Longhorn replicas remain active on the node even after completing the previously outlined procedures.</p><ol><li><p>Drain the node. (This is optional in Harvester.)</p><ul><li><p>Scenario 1: The <code>numReplicas</code> value of all volumes is <code>3</code>, which means that each Longhorn volume has three active replicas.</p><p>The Longhorn Engine recognizes that it can no longer communicate with the replica on the drained node, and then marks that replica as failed. None of the replicas hold any special significance to Longhorn so it functions as long as it can communicate with at least one replica.</p></li><li><p>Scenario 2: Some Longhorn volumes have <em>fewer</em> than three active replicas, or you manually attached volumes using the Harvester UI or Longhorn UI.</p><p>You must manually detach the replicas or move them to other nodes, and then <a href="https://longhorn.io/docs/1.4.3/volumes-and-nodes/maintenance/#updating-the-node-os-or-container-runtime" target="_blank" rel="noopener noreferrer">drain the node</a> using the command <code>kubectl drain --ignore-daemonsets &lt;node name&gt;</code>. The option <code>--ignore-daemonsets</code> is required because Longhorn deploys daemonsets such as Longhorn Manager, Longhorn CSI plugin, and Longhorn Engine image.</p><p>Replicas running on the node are stopped and marked as <code>Failed</code>. Longhorn Engine processes running on the node are migrated with the pod to other nodes. Once the node is fully drained, no replicas and engine processes should remain running on the node.</p></li></ul></li><li><p>Replenish replicas.</p><p>After a node is shut down, Longhorn does not start rebuilding the replicas on other nodes until the <code>replica-replenishment-wait-interval</code> (default value: 600 seconds) is reached. If the node comes back online before the wait interval value is reached, Longhorn reuses the replicas. Otherwise, Longhorn rebuilds the replicas on another node.</p><p>During system maintenance, you can modify the <a href="https://longhorn.io/docs/1.4.3/references/settings/#replica-replenishment-wait-interval" target="_blank" rel="noopener noreferrer"><code>replica-replenishment-wait-interval</code></a> value using the <a href="/v1.3/troubleshooting/harvester#access-embedded-rancher-and-longhorn-dashboards">embedded Longhorn UI</a> to enable faster replica rebuilding.</p><p>Harvester v1.3.0 uses Longhorn v1.6.0, while Harvester v1.2.1 uses Longhorn v1.4.3.</p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="replace-the-nics">Replace the Nics<a href="#replace-the-nics" class="hash-link" aria-label="Direct link to Replace the Nics" title="Direct link to Replace the Nics">​</a></h3><ol><li><p>Shut the node down.</p></li><li><p>Replace the NICs.</p></li><li><p>Restart the node.</p></li><li><p><a href="#collect-information">Collect information</a> about the current network configuration and status.</p></li></ol><p>If you observe any abnormalities, generate a <a href="/v1.3/troubleshooting/harvester#generate-a-support-bundle">support bundle</a> for troubleshooting purposes.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="optional-update-the-network-config-again">(Optional) Update the Network Config Again<a href="#optional-update-the-network-config-again" class="hash-link" aria-label="Direct link to (Optional) Update the Network Config Again" title="Direct link to (Optional) Update the Network Config Again">​</a></h3><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_S0QG"><p>Updating the <code>Network Config</code> is <strong>required</strong> if the new NICs will be placed in different physical slots.</p></div></div><ol><li><p>Add the node to the <code>Network Config</code>.</p><p>You must create a new <code>Network Config</code> or change the <code>Network Config</code> to include this node.</p></li><li><p>Check the <code>Node</code> object.</p><p>The label <code>network.harvesterhci.io/vlanconfig</code> reflects the specific <code>Network Config</code> used.</p></li><li><p>Check the <code>VlanStatus</code> object.</p><p>The status of the <code>VlanStatus</code> object&#x27;s <code>ready</code> condition changes to <code>&quot;True&quot;</code>.</p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="disable-maintenance-mode">Disable Maintenance Mode<a href="#disable-maintenance-mode" class="hash-link" aria-label="Direct link to Disable Maintenance Mode" title="Direct link to Disable Maintenance Mode">​</a></h3><ol><li><p>Wait for the node to be moved back to the cluster.</p></li><li><p>Disable maintenance mode.</p></li><li><p>(Optional) Start the VMs that you manually stopped.</p></li><li><p>(Optional) Manually <a href="/v1.3/vm/live-migration#starting-a-migration">migrate VMs</a> to this node.</p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting">​</a></h3><p>Harvester uses multiple network-related pods and CRDs. When troubleshooting, check the pod logs and the status of CRD objects.</p><p>Pods:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods -n harvester-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                                    READY   STATUS    RESTARTS      AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">harvester-network-controller-cnf22                      1/1     Running   2 (60m ago)   3d22h  // Network controller agent daemonSet, deployed in each node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">harvester-network-controller-manager-859c4bd874-xcllf   1/1     Running   2 (60m ago)   3d22h  // Network controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">harvester-network-webhook-56b877d5d5-z42dp              1/1     Running   2 (60m ago)   3d22h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>CRDs:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">clusternetworks.network.harvesterhci.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">linkmonitors.network.harvesterhci.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vlanconfigs.network.harvesterhci.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vlanstatuses.network.harvesterhci.io</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><div class="col col--12"><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/harvester/docs/edit/main/versioned_docs/version-v1.3/networking/best-practice.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-11-29T02:51:44.000Z">Nov 29, 2024</time></b></span></div></div></footer></div></article><div class="col col--12"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/v1.3/networking/ippool"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">IP Pool</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/v1.3/logging/harvester-logging"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Logging</div></a></nav></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#replace-ethernet-nics" class="table-of-contents__link toc-highlight">Replace Ethernet NICs</a><ul><li><a href="#pre-replacement-checks" class="table-of-contents__link toc-highlight">Pre-Replacement Checks</a></li><li><a href="#collect-information" class="table-of-contents__link toc-highlight">Collect Information</a></li><li><a href="#enable-maintenance-mode" class="table-of-contents__link toc-highlight">Enable Maintenance Mode</a></li><li><a href="#optional-update-the-network-config" class="table-of-contents__link toc-highlight">(Optional) Update the Network Config</a></li><li><a href="#optional-drain-the-node" class="table-of-contents__link toc-highlight">(Optional) Drain the Node</a></li><li><a href="#replace-the-nics" class="table-of-contents__link toc-highlight">Replace the Nics</a></li><li><a href="#optional-update-the-network-config-again" class="table-of-contents__link toc-highlight">(Optional) Update the Network Config Again</a></li><li><a href="#disable-maintenance-mode" class="table-of-contents__link toc-highlight">Disable Maintenance Mode</a></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 SUSE Rancher. All Rights Reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.45156ca4.js"></script>
<script src="/assets/js/main.2f7351ae.js"></script>
</body>
</html>